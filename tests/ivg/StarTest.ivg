FORMAT IVG-3 requires:IMPD-1
BOUNDS 0,0,800,600

PI = 3.141592653589793

//
// Returns r2/r1 ratio into $0 given p and q in $1 and $2
//
// Example:
//		cx = 500
//		cy = 200
//		r = 100
//		p = 12
//		q = 5
//		$STAR-R ratio $p $q
//		STAR [$cx $cy {$p*2} $r1 {$r*$ratio}]
//
STAR-R = CALL [
	LOCAL t = {$PI / $1}
	RETURN $0 = {cos($2 * $t) / cos(($2 - 1) * $t)}
]

PQ-STAR = CALL [
	LOCAL r
	$STAR-R r $3 $4
	STAR {$0},{$1},{$3*2},$2,{$2*$r}
]

LINE-STAR = CALL [
	LOCAL cx = $0
	LOCAL cy = $1
	LOCAL size = $2
	LOCAL p = $3
	LOCAL q = $4
	LOCAL r = {$PI * 2 / $p}
	LOCAL i
	LOCAL t = 0.0
	LOCAL s = M
	LOCAL c = 0
	FOR i FROM:0 TO:$p [
		s = $s {$cx + sin($t) * $size} {$cy - cos($t) * $size}
		t = {$t + $r * $q}
		c = {$c + $q}
		IF {$c % $p == 0} [ t = {$t + $r}; c = 0; s = $s z M ]
	]
	PATH svg:[$s z]
]

fill rule:non-zero
wipe white
options aa-gamma:0.8
pen black width:1.0
r1=100
p=10
q={floor(($p-1)/2)}
q=4
IF {$q > $p / 2} [ q = {$p - $q} ]
$LINE-STAR 200 200 100 $p $q
$STAR-R r $p $q
STAR 500,200,{$p*2},$r1,{$r1*$r}

$PQ-STAR 200 450 100 12 5

// Angle of 0->1 should be 180 + q*2->q*2-1
// i.e. dx,dy of 0->1 == dx,dy of q*2-1->q*2
// ratio = r2/r1
// dx,dy of 0 to 1 == (sin(t)*ratio,-cos(t)*ratio)-(0,-1)
// dx,dy of -1 to 0 == dx0,-dy0
// dx,dy of q*2-1->q*2 == dx0,-dy0 rotated t*q*2
// ==	dx0 * cos(t*q*2) - -dy0 * sin(t*q*2);
//		dx0 * sin(t*q*2) + -dy0 * cos(t*q*2);
//
// Solved and simplified by Mathematica to:
//
// r1*Cos((Pi*q)/p)*Sec((Pi*(-1 + q))/p)

//t = {$PI / $p}
//ratio = {$r2 / $r1}
//dx0 = {sin($t) * $ratio}; dy0 = {1 - cos($t) * $ratio}
//dxQ = {$dx0 * cos($t*$q*2) - -$dy0 * sin($t*$q*2)}
//dyQ = {$dx0 * sin($t*$q*2) + -$dy0 * cos($t*$q*2)}

//trace $dx0 $dy0 $dxQ $dyQ
