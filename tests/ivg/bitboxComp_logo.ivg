format IVG-1 requires:IMPD-1; bounds 0,0,100,40
bit=[
  [ . . . . . . . . . . . . . . . . . . . . . . ]
  [ . X X X X X . . . X X X X . . X X X X X X . ]
  [ . X X : : X X . . . X X : . . . . X X : . . ]
  [ . X X : : X X . . . X X . . . . . X X . . . ]
  [ . X X X X X : . . . X X . . . . . X X . . . ]
  [ . X X : : X X . . . X X . . . . . X X . . . ]
  [ . X X : : X X . . . X X . . . . . X X . . . ]
  [ . X X X X X : . . X X X X . . . . X X . . . ]
  [ . . . . . . . . . . . . . . . . . . . . . . ]
]
box=[
  [ . . . . . . . . . . . . . . . . . . . . . . ]
  [ . X X X X X . . . X X X X . . X X . . X X . ]
  [ . X X : : X X . X X : : X X . X X : . X X . ]
  [ . X X : : X X . X X : : X X . : X X X X . . ]
  [ . X X X X X : . X X : : X X . . : X X : . . ]
  [ . X X : : X X . X X : : X X . . X X X X : . ]
  [ . X X : : X X . X X : : X X . X X : : X X . ]
  [ . X X X X X . . . X X X X . . X X : : X X . ]
  [ . . . . . . . . . . . . . . . . . . . . . . ]
]
viewtilt=0.33
voxelsize=CALL [ 
  voxel_x_size=$0
  voxel_y_size=$1
  voxel_z_size=$2
  voxel_x_tilt={$0*$viewtilt}
  voxel_z_tilt={$2*$viewtilt}
]
hsvadjust=CALL [
  LOCAL h=$1
  LOCAL s=$2
  LOCAL v={$3 * $4}
  if {$4 < 1.0} s={$s + $s * (1.0 - $4)}
  if {$v > 1.0} s={$s * (2.0 - $v)}
  $0=hsv({$h < 0 ? 0 : $h > 1 ? 1 : $h},{$s < 0 ? 0 : $s > 1 ? 1 : $s},{$v < 0 ? 0 : $v > 1 ? 1 : $v})
]
voxelcolor=CALL [
  $hsvadjust fill_front        $0 $1 $2 1    
  $hsvadjust fill_front_shadow $0 $1 $2 0.7  
  $hsvadjust pen_front         $0 $1 $2 0.9
  $hsvadjust pen_bottom        $0 $1 $2 0.50

  $hsvadjust fill_side        $0 $1 $2 0.90  
  $hsvadjust fill_side_shadow $0 $1 $2 0.7  
  $hsvadjust pen_side         $0 $1 $2 0.85

  $hsvadjust fill_top        $0 $1 $2 1.22  
  $hsvadjust fill_top_shadow $0 $1 $2 0.78  
  $hsvadjust pen_top         $0 $1 $2 0.80

  $hsvadjust pen_highlight $0 $1 $2 1.7
]
drawvoxel=CALL [
  if {$1} [
    fill {$7 ? $fill_side_shadow : $fill_side}; pen none; path svg:[M{$voxel_x_size} {$voxel_x_tilt} l{$voxel_z_size} -{$voxel_z_tilt} l0 {$voxel_y_size} l-{$voxel_z_size} {$voxel_z_tilt} z]
    if {$2} [ pen $pen_bottom width:1; path svg:[M{$voxel_x_size} {$voxel_x_tilt+$voxel_y_size} l{$voxel_z_size} -{$voxel_z_tilt}] ]
    if {$4} [ pen $pen_side width:1; path svg:[M{$voxel_x_size+$voxel_z_size} {$voxel_x_tilt+$voxel_y_size-$voxel_z_tilt} l0 -{$voxel_y_size}] ]
  ]
  if {$0} [
    fill {$8 ? $fill_top_shadow : $fill_top}; pen none; path svg:[M0 0 l{$voxel_x_size} {$voxel_x_tilt} l{$voxel_z_size} -{$voxel_z_tilt} l-{$voxel_x_size} -{$voxel_x_tilt} z]
    if {$3} [ pen $pen_top width:1; path svg:[M0 0 l{$voxel_z_size} -{$voxel_z_tilt}] ]
    if {$4} [ pen $pen_top width:1; path svg:[M{$voxel_z_size} -{$voxel_z_tilt} l{$voxel_x_size} {$voxel_x_tilt} ] ]
    if {$1} [ pen $pen_highlight width:2; path svg:[M{$voxel_x_size} {$voxel_x_tilt} l{$voxel_z_size} -{$voxel_z_tilt}] ]
  ]
  if {$5} [
    fill {$6 ? $fill_front_shadow : $fill_front}; pen none; path svg:[M0 0 l{$voxel_x_size} {$voxel_x_tilt} l0 {$voxel_y_size} l-{$voxel_x_size} -{$voxel_x_tilt} z]
    if {$2} [ pen $pen_bottom width:1; path svg:[M0 {$voxel_y_size} l{$voxel_x_size} {$voxel_x_tilt} ] ]
    if {$3} [ pen $pen_front width:1; path svg:[M0 0 l0 {$voxel_y_size}] ]
    if {$1} [ pen $pen_highlight width:2; path svg:[M{$voxel_x_size} {$voxel_x_tilt} l0 {$voxel_y_size}] ]
    if {$0} [ pen $pen_highlight width:2; path svg:[M0 0 l{$voxel_x_size} {$voxel_x_tilt}] ]
  ]
];
voxeltext=CALL [
  LOCAL x
  LOCAL y
  y=0;
  for r in:$0 [
    x=0; 
    for v in:$r [ 
      voxel{$x}.{$y}=$v; 
      x={$x+1} 
    ]; 
    y={$y+1}
  ];
  voxel.x=$x
  voxel.y=$y
  zaxis={$1 == z}
  for y from:{$voxel.y-2} to:1 [
    context [
      for x from:{$zaxis ? $voxel.x-2 : 1} to:{$zaxis ? 1: $voxel.x-2} [         
        if { $voxel($x).($y) == X} [          
          $drawvoxel 
            .. { $voxel($x).($y-1) != X }
            .. { $zaxis || $voxel($x+1).($y) != X }
            .. { $voxel($x).($y+1) != X }
            .. { $zaxis || $voxel($x-1).($y) != X }
            .. { !$zaxis || $voxel($x+1).($y) != X }
            .. { !$zaxis || $voxel($x-1).($y) != X }
            .. { $zaxis && $voxel($x-1).($y) != . }
            .. { !$zaxis && $voxel($x+1).($y) != .}
            .. { $voxel($x).($y-1) != .}
        ]
        offset { ($zaxis ? -$voxel_z_size : $voxel_x_size)-0.1},{ ($zaxis ? $voxel_z_tilt : $voxel_x_tilt)-0.1}
      ]
    ]
    offset 0,-{$voxel_y_size-0.1}
  ] 
]
reset
options aa-gamma:2.5
scale 0.84
offset 30,4.8
fill none; pen #90000000 width:3 caps:square; path svg:[M0 0 l32 0 l9 -3 l9 3 l34 0 L84 41 L0 41 z]
fill #333388; pen #8080d0 width:2 caps:square; rect 0,0,84,41
offset 2,17; scale 0.1,0.1
options aa-gamma:1.2
context [
  pen width:1
  offset 120,-110
  $voxelsize 270 160 270
  $voxelcolor {230/360} 0.80 0.95
  $drawvoxel yes yes yes yes yes yes   no no no
]
context [
  offset 290,-172
  $voxelsize 99 24 99 
  $voxelcolor {235/360} 0 0.66
  $drawvoxel yes yes yes yes yes yes   yes yes no
  offset 115,38
  $drawvoxel yes yes yes yes yes yes   yes no no 
  offset -230,0
  $drawvoxel yes yes yes yes yes yes   no yes no
  offset 115,38
  $drawvoxel yes yes yes yes yes yes   no no no
]
options aa-gamma:2.5
context [
  offset 15,80
  $voxelsize 15 20 50
  $voxelcolor {355/360} 0.80 0.99
  $voxeltext $bit x  
]
context [
  offset 714,70
  $voxelsize 50 20 15
  $voxelcolor {125/360} 0.80 0.99
  $voxeltext $box z
]